{"version":3,"file":"plugin.cjs.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst RemoteStreamer = registerPlugin('RemoteStreamer', {\n    web: () => import('./web').then(m => new m.RemoteStreamerWeb()),\n});\nexport * from './definitions';\nexport { RemoteStreamer };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class RemoteStreamerWeb extends WebPlugin {\n    constructor() {\n        super(...arguments);\n        this.audio = null;\n        this.intervalId = null;\n        this.isLooping = false;\n        this.fadeInterval = null;\n        this.FADE_DURATION = 1000; // 1 second fade\n        this.FADE_STEP = 50; // Update every 50ms\n    }\n    async setNowPlayingInfo(options) {\n        console.log(\"Setting now playing info\", options);\n    }\n    async enableCommandCenter(options) {\n        console.log(\"Enabling lock screen control\", options);\n    }\n    async setLoop(options) {\n        this.isLooping = options.loop;\n        if (this.audio) {\n            this.audio.loop = this.isLooping;\n        }\n    }\n    async play(options) {\n        if (this.audio) {\n            console.log('plugin play() pause');\n            await this.fadeOut();\n            this.audio.pause();\n        }\n        console.log('plugin play() after pause');\n        this.audio = new Audio(options.url);\n        this.audio.id = \"pluginAudioElement\"; // Assigning an ID to the audio element\n        this.audio.loop = this.isLooping; // Set loop property\n        // Minimize loop gap\n        this.audio.preload = \"auto\";\n        this.audio.volume = 0; // Start at 0 volume for fade in\n        // Wait for enough data before playing\n        await new Promise((resolve) => {\n            if (this.audio) {\n                this.audio.addEventListener('canplaythrough', resolve, { once: true });\n                this.audio.load();\n            }\n        });\n        this.setupEventListeners(); // Call setupEventListeners here\n        await this.audio.play();\n        await this.fadeIn();\n        this.notifyListeners('play', {});\n        this.startTimeUpdates();\n    }\n    async fadeIn() {\n        if (!this.audio)\n            return;\n        return new Promise((resolve) => {\n            let volume = 0;\n            this.audio.volume = volume;\n            this.fadeInterval = window.setInterval(() => {\n                volume = Math.min(volume + (this.FADE_STEP / this.FADE_DURATION), 1);\n                if (this.audio) {\n                    this.audio.volume = volume;\n                }\n                if (volume >= 1) {\n                    if (this.fadeInterval) {\n                        clearInterval(this.fadeInterval);\n                        this.fadeInterval = null;\n                    }\n                    resolve();\n                }\n            }, this.FADE_STEP);\n        });\n    }\n    async fadeOut() {\n        if (!this.audio)\n            return;\n        return new Promise((resolve) => {\n            let volume = this.audio ? this.audio.volume : 0;\n            this.fadeInterval = window.setInterval(() => {\n                volume = Math.max(volume - (this.FADE_STEP / this.FADE_DURATION), 0);\n                if (this.audio) {\n                    this.audio.volume = volume;\n                }\n                if (volume <= 0) {\n                    if (this.fadeInterval) {\n                        clearInterval(this.fadeInterval);\n                        this.fadeInterval = null;\n                    }\n                    resolve();\n                }\n            }, this.FADE_STEP);\n        });\n    }\n    async pause() {\n        if (this.audio) {\n            await this.fadeOut();\n            this.audio.pause();\n            this.notifyListeners('pause', {});\n        }\n    }\n    async resume() {\n        if (this.audio) {\n            await this.audio.play();\n            this.notifyListeners('play', {});\n        }\n    }\n    async seekTo(options) {\n        if (this.audio) {\n            this.audio.currentTime = options.position;\n        }\n    }\n    async stop() {\n        if (this.audio) {\n            await this.fadeOut();\n            this.audio.pause();\n            this.audio.src = '';\n            this.audio.load();\n            this.audio.currentTime = 0;\n            this.audio = null;\n            this.notifyListeners('stop', {});\n            this.stopTimeUpdates();\n            console.log('stopped', this.audio);\n        }\n    }\n    async setPlaybackRate(options) {\n        if (this.audio) {\n            this.audio.playbackRate = options.rate;\n        }\n    }\n    startTimeUpdates() {\n        this.stopTimeUpdates();\n        this.intervalId = window.setInterval(() => {\n            if (this.audio) {\n                this.notifyListeners('timeUpdate', { currentTime: this.audio.currentTime });\n            }\n        }, 1000);\n    }\n    stopTimeUpdates() {\n        if (this.intervalId !== null) {\n            window.clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n    }\n    async setVolume(options) {\n        if (this.audio) {\n            this.audio.volume = options.volume;\n        }\n    }\n    setupEventListeners() {\n        if (this.audio) {\n            this.audio.onplaying = () => this.notifyListeners('play', {});\n            this.audio.onpause = () => this.notifyListeners('pause', {});\n            this.audio.onended = () => this.notifyListeners('stop', { ended: true });\n            this.audio.onerror = (e) => this.notifyListeners('error', { message: `Audio error: ${e}` });\n            this.audio.onwaiting = () => this.notifyListeners('buffering', { isBuffering: true });\n            this.audio.oncanplaythrough = () => this.notifyListeners('buffering', { isBuffering: false });\n        }\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}